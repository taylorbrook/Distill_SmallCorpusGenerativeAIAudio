---
milestone: v1.1
audited: 2026-02-27T19:00:00Z
status: gaps_found
scores:
  requirements: 11/25
  phases: 3/5
  integration: 4/5
  flows: 4/5
gaps:
  requirements:
    - id: "VOC-05"
      status: "unsatisfied"
      phase: "Phase 16"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 16 not started; get_vocoder() only supports 'bigvgan', no auto-selection logic exists"
    - id: "GEN-04"
      status: "unsatisfied"
      phase: "Phase 16"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 16 not started; Griffin-Lim still used in mel_adapter.py and controls/analyzer.py"
    - id: "UI-01"
      status: "unsatisfied"
      phase: "Phase 15"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 15 not started; no vocoder selection widget in generate_tab.py"
    - id: "UI-02"
      status: "unsatisfied"
      phase: "Phase 15"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 15 not started; download progress not surfaced in UI"
    - id: "UI-03"
      status: "unsatisfied"
      phase: "Phase 16"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 16 not started; no Train Vocoder option in UI"
    - id: "UI-04"
      status: "unsatisfied"
      phase: "Phase 16"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 16 not started; no vocoder training progress display"
    - id: "CLI-01"
      status: "unsatisfied"
      phase: "Phase 15"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 15 not started; no --vocoder flag on CLI generate command"
    - id: "CLI-02"
      status: "unsatisfied"
      phase: "Phase 16"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 16 not started; no train-vocoder CLI command"
    - id: "CLI-03"
      status: "unsatisfied"
      phase: "Phase 15"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 15 not started; is_bigvgan_cached() exists but not exported or consumed"
    - id: "TRAIN-01"
      status: "unsatisfied"
      phase: "Phase 16"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 16 not started; no HiFi-GAN training pipeline"
    - id: "TRAIN-02"
      status: "unsatisfied"
      phase: "Phase 16"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 16 not started; no adversarial training loop"
    - id: "TRAIN-03"
      status: "unsatisfied"
      phase: "Phase 16"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 16 not started; no data augmentation for vocoder training"
    - id: "TRAIN-04"
      status: "unsatisfied"
      phase: "Phase 16"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 16 not started; vocoder_state plumbing exists (PERS-01) but never populated"
    - id: "TRAIN-05"
      status: "unsatisfied"
      phase: "Phase 16"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 16 not started; no cancel/resume for vocoder training"
  integration:
    - from: "Phase 13 (save_model)"
      to: "Phase 16 (vocoder_state population)"
      issue: "vocoder_state plumbing exists but is never populated — save_model() always called with vocoder_state=None in current code"
      affected_requirements: ["PERS-01", "PERS-03"]
  flows:
    - flow: "Save/Load Vocoder State Round-Trip"
      breaks_at: "vocoder_state is never set during save (always None)"
      affected_requirements: ["PERS-01", "VOC-05"]
tech_debt:
  - phase: 14-generation-pipeline-integration
    items:
      - "BlendEngine creates new BigVGANVocoder on every blend_generate() call — ~489MB weight re-instantiation; should cache vocoder instance"
      - "generate_reconstruction_preview() has vocoder=None default but no guard — AttributeError if called without vocoder"
      - "Stale docstrings referencing 48kHz in generation.py lines 106, 652 (actual internal_sr is 44100)"
  - phase: 12-vocoder-interface-bigvgan-integration
    items:
      - "is_bigvgan_cached() not exported from distill.vocoder.__init__ — Phase 15 will need it for UI download progress"
  - phase: 13-model-persistence-v2
    items:
      - "loaded.vocoder_state not consumed in library_tab.py or cli/generate.py — always creates fresh BigVGAN regardless of bundled state (Phase 15/16 wiring needed)"
---

# v1.1 HiFi-GAN Vocoder — Milestone Audit Report

**Audited:** 2026-02-27
**Status:** gaps_found
**Score:** 11/25 requirements satisfied (1 dropped, 14 unsatisfied)

## Milestone Definition of Done

> Replace Griffin-Lim reconstruction with neural vocoders (BigVGAN-v2 universal + optional per-model HiFi-GAN V2) for dramatically improved audio quality, then fully remove Griffin-Lim.

## Phase Summary

| Phase | Name | Status | Verification |
|-------|------|--------|-------------|
| 12 | Vocoder Interface & BigVGAN Integration | Complete | passed (5/5 truths) |
| 13 | Model Persistence v2 | Complete | passed (3/4 truths; PERS-02 dropped by user) |
| 14 | Generation Pipeline Integration | Complete | passed (8/8 must-haves) |
| 15 | UI & CLI Vocoder Controls | **Not Started** | no directory |
| 16 | Per-Model HiFi-GAN Training & Griffin-Lim Removal | **Not Started** | no directory |

## Requirements Coverage (3-Source Cross-Reference)

### Satisfied Requirements (11)

| REQ-ID | Description | Phase | VERIFICATION | REQUIREMENTS.md |
|--------|-------------|-------|--------------|-----------------|
| VOC-01 | BigVGAN-v2 as default reconstruction | 12 | SATISFIED | [x] Complete |
| VOC-02 | Mel adapter (VAE → BigVGAN format) | 12 | SATISFIED | [x] Complete |
| VOC-03 | Auto-download with progress | 12 | SATISFIED | [x] Complete |
| VOC-04 | CUDA/MPS/CPU inference | 12 | SATISFIED | [x] Complete |
| VOC-06 | BigVGAN vendored with pin | 12 | SATISFIED | [x] Complete |
| PERS-01 | Model format v2 with vocoder state | 13 | SATISFIED | [x] Complete |
| PERS-03 | Catalog shows vocoder stats | 13 | SATISFIED | [x] Complete |
| GEN-01 | All 5 generation paths use vocoder | 14 | SATISFIED | [x] Complete |
| GEN-02 | 44.1kHz → 48kHz resampling | 14 | SATISFIED | [x] Complete |
| GEN-03 | Export pipeline unchanged | 14 | SATISFIED | [x] Complete |

### Dropped Requirements (1)

| REQ-ID | Description | Phase | Reason |
|--------|-------------|-------|--------|
| PERS-02 | v1 backward compatibility | 13 | User decided: v1 .distill files rejected with retrain message instead |

### Unsatisfied Requirements (14)

#### Phase 15 (Not Started) — 4 requirements

| REQ-ID | Description |
|--------|-------------|
| UI-01 | Vocoder selection dropdown in Generate tab |
| UI-02 | BigVGAN download progress in UI |
| CLI-01 | `--vocoder` flag on CLI generate command |
| CLI-03 | Rich progress bar for BigVGAN download |

#### Phase 16 (Not Started) — 10 requirements

| REQ-ID | Description |
|--------|-------------|
| VOC-05 | Auto-select best vocoder (per-model > BigVGAN) |
| GEN-04 | Griffin-Lim fully removed |
| UI-03 | Train Vocoder option in UI |
| UI-04 | Vocoder training progress display |
| CLI-02 | `train-vocoder` CLI command |
| TRAIN-01 | Train HiFi-GAN V2 on model audio |
| TRAIN-02 | Adversarial loss (MPD+MSD + mel + feature matching) |
| TRAIN-03 | Data augmentation for vocoder training |
| TRAIN-04 | Trained vocoder bundled into model file |
| TRAIN-05 | Cancel/resume for vocoder training |

## Cross-Phase Integration

### E2E Flows Verified

| Flow | Status | Details |
|------|--------|---------|
| Model Load → Vocoder → Generation → Export | COMPLETE | library_tab → get_vocoder → GenerationPipeline → export_audio |
| Training → Preview with Vocoder | COMPLETE | loop.py → get_vocoder (once) → generate_preview |
| CLI Generate → Vocoder → Export | COMPLETE | cli/generate.py → get_vocoder → GenerationPipeline → export |
| Blending → Vocoder per Slot | COMPLETE | blending.py → get_vocoder → GenerationPipeline per model |
| Save/Load Vocoder State | PARTIAL | Plumbing wired (PERS-01) but vocoder_state never populated (Phase 16) |

### Integration Issues

1. **vocoder_state never populated:** `save_model()` is always called with `vocoder_state=None` — the plumbing exists but no phase currently produces vocoder state data. Phase 16 will close this.

2. **loaded.vocoder_state ignored:** Both `library_tab.py` and `cli/generate.py` unconditionally create a BigVGAN vocoder on model load, ignoring any bundled vocoder state. Phase 15/16 must add conditional vocoder selection.

## Tech Debt

### Phase 14: Generation Pipeline Integration
- BlendEngine creates new BigVGANVocoder (~489MB weight load) on every `blend_generate()` call — should cache
- `generate_reconstruction_preview()` has `vocoder=None` default but crashes on `vocoder._device` without guard
- Stale docstrings referencing 48kHz in `generation.py` lines 106, 652

### Phase 12: Vocoder Interface
- `is_bigvgan_cached()` not exported from `distill.vocoder.__init__` — Phase 15 needs it

### Phase 13: Model Persistence v2
- `loaded.vocoder_state` not consumed in `library_tab.py` or `cli/generate.py` — always defaults to BigVGAN

**Total: 5 tech debt items across 3 phases**

## Conclusion

Phases 12-14 are **solid** — all completed requirements verified, cross-phase integration wired correctly, and 4/5 E2E flows complete. The partial flow (vocoder state round-trip) is architecturally correct and will activate when Phase 16 provides data.

However, the milestone is **not complete**: 14 of 25 requirements remain unsatisfied because Phases 15 and 16 have not been started. These cover UI/CLI vocoder controls, per-model HiFi-GAN training, and Griffin-Lim removal.

---

*Audited: 2026-02-27*
*Auditor: Claude (gsd milestone-audit)*
